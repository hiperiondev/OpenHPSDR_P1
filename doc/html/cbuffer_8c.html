<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OpenHPSDR_P1: cbuffer.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OpenHPSDR_P1
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
   <div id="projectbrief">Complete implementation of OpenHPSDR protocol v1</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_294a843b2bfd3ca908703ab7a62034f5.html">hpsdr_p1</a></li><li class="navelem"><a class="el" href="dir_52f0be7df0f7f81b45f6e280bdf0ac9e.html">utils</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">cbuffer.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;assert.h&gt;</code><br />
<code>#include &lt;sys/mman.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &quot;<a class="el" href="cbuffer_8h_source.html">cbuffer.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a73a3b169ac8c3419cbe15327e75ffcfd"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cbuffer_8c.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>()&#160;&#160;&#160;assert(0)</td></tr>
<tr class="separator:a73a3b169ac8c3419cbe15327e75ffcfd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae4f86bff73414c5fc08c058f957212f0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cbuffer_8c.html#ae4f86bff73414c5fc08c058f957212f0">MAP_ANONYMOUS</a>&#160;&#160;&#160;MAP_ANON</td></tr>
<tr class="separator:ae4f86bff73414c5fc08c058f957212f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a3feee4acceb69387efa6055c1f5d081c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structcbuf__t.html">cbuf_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cbuffer_8c.html#a3feee4acceb69387efa6055c1f5d081c">cbuf_new</a> (const unsigned int order)</td></tr>
<tr class="separator:a3feee4acceb69387efa6055c1f5d081c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac538dc33c515a0b7e47f1c462388c51b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cbuffer_8c.html#ac538dc33c515a0b7e47f1c462388c51b">cbuf_free</a> (<a class="el" href="structcbuf__t.html">cbuf_t</a> *me)</td></tr>
<tr class="separator:ac538dc33c515a0b7e47f1c462388c51b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acdcb4be1fe5ddd4b3980ef1dec01ece2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cbuffer_8c.html#acdcb4be1fe5ddd4b3980ef1dec01ece2">cbuf_is_empty</a> (const <a class="el" href="structcbuf__t.html">cbuf_t</a> *me)</td></tr>
<tr class="separator:acdcb4be1fe5ddd4b3980ef1dec01ece2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d0b6a2d8da53227c4e86e265f589b4e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cbuffer_8c.html#a0d0b6a2d8da53227c4e86e265f589b4e">cbuf_offer</a> (<a class="el" href="structcbuf__t.html">cbuf_t</a> *me, void *data, const int <a class="el" href="hpsdr__network_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)</td></tr>
<tr class="separator:a0d0b6a2d8da53227c4e86e265f589b4e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae269c767c5af820e46071b4f65b0975"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cbuffer_8c.html#aae269c767c5af820e46071b4f65b0975">cbuf_peek</a> (const <a class="el" href="structcbuf__t.html">cbuf_t</a> *me)</td></tr>
<tr class="separator:aae269c767c5af820e46071b4f65b0975"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4cad51ff57a93164ee749c51beddf77"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cbuffer_8c.html#ad4cad51ff57a93164ee749c51beddf77">cbuf_poll</a> (<a class="el" href="structcbuf__t.html">cbuf_t</a> *me, const unsigned int <a class="el" href="hpsdr__network_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)</td></tr>
<tr class="separator:ad4cad51ff57a93164ee749c51beddf77"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24b1050ebf908e6d8d7800883e92313d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cbuffer_8c.html#a24b1050ebf908e6d8d7800883e92313d">cbuf_size</a> (const <a class="el" href="structcbuf__t.html">cbuf_t</a> *me)</td></tr>
<tr class="separator:a24b1050ebf908e6d8d7800883e92313d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1efb407eafefd109868ef07a09abaed"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cbuffer_8c.html#aa1efb407eafefd109868ef07a09abaed">cbuf_usedspace</a> (const <a class="el" href="structcbuf__t.html">cbuf_t</a> *me)</td></tr>
<tr class="separator:aa1efb407eafefd109868ef07a09abaed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add5a35d72350b8631ada0ae81e0f42e4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cbuffer_8c.html#add5a35d72350b8631ada0ae81e0f42e4">cbuf_unusedspace</a> (const <a class="el" href="structcbuf__t.html">cbuf_t</a> *me)</td></tr>
<tr class="separator:add5a35d72350b8631ada0ae81e0f42e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a73a3b169ac8c3419cbe15327e75ffcfd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a73a3b169ac8c3419cbe15327e75ffcfd">&#9670;&nbsp;</a></span>fail</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define fail</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td>&#160;&#160;&#160;assert(0)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Copyright (c) 2014, Willem-Hendrik Thiart Use of this source code is governed by a BSD-style license that can be found in the LICENSE file. </p>

</div>
</div>
<a id="ae4f86bff73414c5fc08c058f957212f0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae4f86bff73414c5fc08c058f957212f0">&#9670;&nbsp;</a></span>MAP_ANONYMOUS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAP_ANONYMOUS&#160;&#160;&#160;MAP_ANON</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>OSX needs some help here </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ac538dc33c515a0b7e47f1c462388c51b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac538dc33c515a0b7e47f1c462388c51b">&#9670;&nbsp;</a></span>cbuf_free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cbuf_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structcbuf__t.html">cbuf_t</a> *&#160;</td>
          <td class="paramname"><em>cb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Free memory used by circular buffer </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cb</td><td>The circular buffer. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="acdcb4be1fe5ddd4b3980ef1dec01ece2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acdcb4be1fe5ddd4b3980ef1dec01ece2">&#9670;&nbsp;</a></span>cbuf_is_empty()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cbuf_is_empty </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structcbuf__t.html">cbuf_t</a> *&#160;</td>
          <td class="paramname"><em>cb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Tell if the circular buffer is empty. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cb</td><td>The circular buffer. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 if empty; otherwise 0 </dd></dl>

</div>
</div>
<a id="a3feee4acceb69387efa6055c1f5d081c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3feee4acceb69387efa6055c1f5d081c">&#9670;&nbsp;</a></span>cbuf_new()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structcbuf__t.html">cbuf_t</a>* cbuf_new </td>
          <td>(</td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>order</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create new circular buffer. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">order</td><td>Size of the circular buffer when taking this as a power of 2. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>pointer to new circular buffer </dd></dl>

</div>
</div>
<a id="a0d0b6a2d8da53227c4e86e265f589b4e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0d0b6a2d8da53227c4e86e265f589b4e">&#9670;&nbsp;</a></span>cbuf_offer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cbuf_offer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structcbuf__t.html">cbuf_t</a> *&#160;</td>
          <td class="paramname"><em>cb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Write data to the tail of the circular buffer. Increases the position of the tail. This copies data to the circular buffer using memcpy. After calling you should free the data if you don't need it anymore.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cb</td><td>The circular buffer. </td></tr>
    <tr><td class="paramname">data</td><td>Buffer to be written to the circular buffer. </td></tr>
    <tr><td class="paramname">size</td><td>Size of the buffer to be added to the circular buffer in bytes. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>number of bytes offered </dd></dl>

</div>
</div>
<a id="aae269c767c5af820e46071b4f65b0975"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae269c767c5af820e46071b4f65b0975">&#9670;&nbsp;</a></span>cbuf_peek()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* cbuf_peek </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structcbuf__t.html">cbuf_t</a> *&#160;</td>
          <td class="paramname"><em>cb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Look at data at the circular buffer's head. Use cbuf_usedspace to determine how much data in bytes can be read. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cb</td><td>The circular buffer. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>pointer to the head of the circular buffer </dd></dl>

</div>
</div>
<a id="ad4cad51ff57a93164ee749c51beddf77"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4cad51ff57a93164ee749c51beddf77">&#9670;&nbsp;</a></span>cbuf_poll()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* cbuf_poll </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structcbuf__t.html">cbuf_t</a> *&#160;</td>
          <td class="paramname"><em>cb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Release data at the head from the circular buffer. Increase the position of the head.</p>
<p>WARNING: this is a dangerous call if:</p><ol type="1">
<li>You are using the returned data pointer.</li>
<li>Another thread has offerred data to the circular buffer.</li>
</ol>
<p>If you want to access the data from the returned pointer you are better off using cbuf_peek.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cb</td><td>The circular buffer. </td></tr>
    <tr><td class="paramname">size</td><td>Number of bytes to release </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>pointer to data; NULL if we can't poll this much data </dd></dl>

</div>
</div>
<a id="a24b1050ebf908e6d8d7800883e92313d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a24b1050ebf908e6d8d7800883e92313d">&#9670;&nbsp;</a></span>cbuf_size()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cbuf_size </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structcbuf__t.html">cbuf_t</a> *&#160;</td>
          <td class="paramname"><em>cb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Size in bytes of the circular buffer. Is equal to 2 ^ order.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cb</td><td>The circular buffer. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>size of the circular buffer in bytes </dd></dl>

</div>
</div>
<a id="add5a35d72350b8631ada0ae81e0f42e4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#add5a35d72350b8631ada0ae81e0f42e4">&#9670;&nbsp;</a></span>cbuf_unusedspace()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cbuf_unusedspace </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structcbuf__t.html">cbuf_t</a> *&#160;</td>
          <td class="paramname"><em>cb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Tell how much data we can write in bytes to the circular buffer. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cb</td><td>The circular buffer. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>number of bytes of how much data can be written </dd></dl>

</div>
</div>
<a id="aa1efb407eafefd109868ef07a09abaed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1efb407eafefd109868ef07a09abaed">&#9670;&nbsp;</a></span>cbuf_usedspace()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cbuf_usedspace </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structcbuf__t.html">cbuf_t</a> *&#160;</td>
          <td class="paramname"><em>cb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Tell how much data has been written in bytes to the circular buffer. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cb</td><td>The circular buffer. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>number of bytes of how data has been written </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
